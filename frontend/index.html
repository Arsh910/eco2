<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./src/index.css">
  <title>Eco2</title>
  <link rel="shortcut icon" href="/logo/logo.png" type="image/x-icon">
</head>

<body>
  <div id="root"></div>
  <script>
    (function () {
      const link = document.querySelector("link[rel*='icon']") || document.createElement('link');
      link.type = 'image/png';
      link.rel = 'shortcut icon';
      document.getElementsByTagName('head')[0].appendChild(link);

      const canvas = document.createElement('canvas');
      canvas.width = 32;
      canvas.height = 32;
      const ctx = canvas.getContext('2d');
      const img = new Image();
      img.src = '/logo/logo.png';

      // Global function to update progress
      // percent: 0 to 100
      window.setFaviconProgress = (percent) => {
        if (!img.complete) return;

        ctx.clearRect(0, 0, 32, 32);

        // Draw logo
        ctx.save();
        ctx.translate(16, 16);
        ctx.drawImage(img, -20, -20, 40, 40);
        ctx.restore();

        if (percent > 0 && percent < 100) {
          ctx.save();
          ctx.translate(16, 16);
          ctx.rotate(-Math.PI / 2);
          ctx.beginPath();
          const angle = (Math.PI * 2 * percent) / 100;
          ctx.arc(0, 0, 15, 0, angle);
          ctx.lineWidth = 2;
          ctx.strokeStyle = '#fa9c05';
          ctx.stroke();
          ctx.restore();
        }

        link.href = canvas.toDataURL('image/png');
      };

      img.onload = () => {
        window.setFaviconProgress(0);
        let progress = 0;
        const interval = setInterval(() => {
          progress += 2;
          window.setFaviconProgress(progress);
          if (progress >= 100) clearInterval(interval);
        }, 50);
      };
    })();
  </script>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>